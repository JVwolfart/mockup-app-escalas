<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa de Escalas - App Escala Callcenter</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <style>
    body.light-theme {
      background-color: #f0fdf4;
      color: #212529;
    }

    body.dark-theme {
      background-color: #121212;
      color: #f8f9fa;
    }

    /* Cores das atividades */
    .activity-blip {
      background-color: #81c784 !important;
      color: #000 !important;
    }

    .activity-email {
      background-color: #64b5f6 !important;
      color: #000 !important;
    }

    .activity-phone {
      background-color: #4db6ac !important;
      color: #000 !important;
    }

    .activity-bko {
      background-color: #ba68c8 !important;
      color: #000 !important;
    }

    .activity-folga {
      background-color: #e57373 !important;
      color: #000 !important;
    }

    .activity-fora {
      background-color: #ffb74d !important;
      color: #000 !important;
    }

    .activity-intervalo {
      background-color: #ffd54f !important;
      color: #000 !important;
    }

    select.form-select {
      min-width: 120px;
      font-size: 0.9rem;
      transition: background-color 0.3s ease;
    }

    /* Container da tabela com scroll horizontal */
    .table-container {
      overflow-x: auto;
      max-width: 100%;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 6px;
    }

    /* Cards resumo de atividades */
    .card-activity {
      font-size: 0.9rem;
      margin-bottom: 1rem;
      text-align: center;
    }

  /* ... seu CSS anterior ... */

  .table-container {
    overflow-x: auto;
    max-width: 100%;
    border: 1px solid #ddd;
    padding: 10px;
    border-radius: 6px;
  }

  table.table {
    border-collapse: separate;
    border-spacing: 0;
  }

  /* Colunas fixas (1 a 5) */
  /* Usar position sticky para fixar as primeiras colunas */
  thead th:nth-child(1),
  tbody td:nth-child(1) {
    position: sticky;
    left: 0;
    background: white;
    z-index: 5;
    border-right: 1px solid #dee2e6;
  }

  thead th:nth-child(2),
  tbody td:nth-child(2) {
    position: sticky;
    left: 100px; /* largura aproximada da primeira coluna */
    background: white;
    z-index: 5;
    border-right: 1px solid #dee2e6;
  }

  thead th:nth-child(3),
  tbody td:nth-child(3) {
    position: sticky;
    left: 180px; /* soma das larguras anteriores */
    background: white;
    z-index: 5;
    border-right: 1px solid #dee2e6;
  }

  thead th:nth-child(4),
  tbody td:nth-child(4) {
    position: sticky;
    left: 260px; /* soma das larguras anteriores */
    background: white;
    z-index: 5;
    border-right: 1px solid #dee2e6;
  }

  thead th:nth-child(5),
  tbody td:nth-child(5) {
    position: sticky;
    left: 340px; /* soma das larguras anteriores */
    background: white;
    z-index: 5;
    border-right: 1px solid #dee2e6;
  }

  /* Ajuste das larguras das colunas fixas */
  th:nth-child(1),
  td:nth-child(1) {
    min-width: 100px;
    max-width: 100px;
  }

  th:nth-child(2),
  td:nth-child(2) {
    min-width: 80px;
    max-width: 80px;
  }

  th:nth-child(3),
  td:nth-child(3),
  th:nth-child(4),
  td:nth-child(4),
  th:nth-child(5),
  td:nth-child(5) {
    min-width: 80px;
    max-width: 80px;
  }
  th:nth-child(1),
td:nth-child(1) {
  min-width: 100px;
  max-width: 100px;
}

th:nth-child(2),
td:nth-child(2) {
  min-width: 80px;
  max-width: 80px;
}

th:nth-child(3),
td:nth-child(3),
th:nth-child(4),
td:nth-child(4),
th:nth-child(5),
td:nth-child(5) {
  min-width: 80px;
  max-width: 80px;
}
/* Ajuste das larguras das colunas fixas */
th:nth-child(1),
td:nth-child(1) {
  min-width: 140px;
  max-width: 140px;
}

th:nth-child(2),
td:nth-child(2) {
  min-width: 120px;
  max-width: 120px;
}

th:nth-child(3),
td:nth-child(3),
th:nth-child(4),
td:nth-child(4),
th:nth-child(5),
td:nth-child(5) {
  min-width: 120px;
  max-width: 120px;
}

/* Ajuste dos posicionamentos sticky left */
thead th:nth-child(1),
tbody td:nth-child(1) {
  left: 0;
  background: white;
  z-index: 4;
  border-right: 1px solid #dee2e6;
  position: sticky;
}

thead th:nth-child(2),
tbody td:nth-child(2) {
  left: 140px; /* largura da primeira coluna */
  background: white;
  z-index: 4;
  border-right: 1px solid #dee2e6;
  position: sticky;
}

thead th:nth-child(3),
tbody td:nth-child(3) {
  left: 260px; /* soma das larguras anteriores: 140 + 110 */
  background: white;
  z-index: 4;
  border-right: 1px solid #dee2e6;
  position: sticky;
}

thead th:nth-child(4),
tbody td:nth-child(4) {
  left: 380px; /* 140 + 110 + 110 */
  background: white;
  z-index: 4;
  border-right: 1px solid #dee2e6;
  position: sticky;
}

thead th:nth-child(5),
tbody td:nth-child(5) {
  left: 500px; /* 140 + 110 + 110 */
  background: white;
  z-index: 4;
  border-right: 1px solid #dee2e6;
  position: sticky;
}


  </style>
</head>

<body class="light-theme">
  <div class="container py-4">
    <!-- Cabeçalho -->
    <header class="d-flex justify-content-between align-items-center mb-4">
      <div><img src="https://logopng.com.br/logos/nestle-107.png" alt="Logo" height="40" /></div>
      <h4 class="m-0">Mapa de Escalas</h4>
      <div class="d-flex align-items-center">
        <span class="me-2">Usuário</span>
        <img src="https://media.gettyimages.com/id/1300845620/pt/vetorial/user-icon-flat-isolated-on-white-background-user-symbol-vector-illustration.jpg?s=2048x2048&w=gi&k=20&c=ISKlZq0E05HEoEEqiMDXisAQJhPdRUjMUJM0sFjifjY=" alt="Avatar" class="rounded-circle" width="40" />
      </div>
    </header>

    <!-- Menu Navegação -->
    <nav class="mb-4">
      <a href="cadastro.html" class="btn btn-outline-success me-2">Cadastro de Atendentes</a>
      <a href="mapa.html" class="btn btn-outline-primary">Mapa de Escalas</a>
    </nav>

    <!-- Seletor de Data -->
    <div class="mb-4">
      <label for="dataSelecionada" class="form-label">Selecione a Data:</label>
      <input type="date" id="dataSelecionada" class="form-control w-auto" />
    </div>

    <!-- Cards Resumo de Atividades por Horário -->
    <div class="row mb-4" id="cardsResumo"></div>

    <!-- Tabela Escalas com scroll horizontal -->
    <div class="table-container">
      <table class="table table-bordered table-sm align-middle text-center" style="min-width: 1500px;">
        <thead class="table-light">
          <tr>
            <th>Nome</th>
            <th>Área</th>
            <th>Horário</th>
            <th>Pausa-1</th>
            <th>Pausa-2</th>
            <th>06:00-07:00</th>
            <th>07:00-08:00</th>
            <th>08:00-09:00</th>
            <th>09:00-10:00</th>
            <th>10:00-11:00</th>
            <th>11:00-12:00</th>
            <th>12:00-13:00</th>
            <th>13:00-14:00</th>
            <th>14:00-15:00</th>
            <th>15:00-16:00</th>
            <th>16:00-17:00</th>
            <th>17:00-18:00</th>
            <th>18:00-19:00</th>
            <th>19:00-20:00</th>
            <th>20:00-21:00</th>
          </tr>
        </thead>
        <tbody id="tabelaAtendentes"></tbody>
      </table>
    </div>
  </div>

  <script>
    const atendentes = [
      {
        nome: "Atendente 1",
        horario: "08:00-17:00",
        area: "Atendimento",
        pausa1: "10:10-10:20",
        pausa2: "14:00-14:10",
        atividades: [
        "fora de escala", "fora de escala", "telefone", "telefone", "intervalo",
        "e-mail", "intervalo", "blip chat", "e-mail", "blip chat",
        "e-mail", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
        ]
      },
      {
        nome: "Atendente 2",
        area: "Marketing",
        horario: "09:00-18:00",
        pausa1: "10:20-10:30",
        pausa2: "15:10-15:20",
        atividades: [
"fora de escala", "fora de escala", "fora de escala", "telefone", "BKO",
"e-mail", "intervalo", "blip chat", "e-mail", "blip chat",
"e-mail", "telefone", "fora de escala", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 3",
        area: "Back Office",
        horario: "07:00-16:00",
        pausa1: "10:00-10:10",
        pausa2: "14:00-14:10",
        atividades: [
"fora de escala", "blip chat", "telefone", "telefone", "e-mail",
"intervalo", "e-mail", "blip chat", "e-mail", "telefone",
"fora de escala", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
],
      },
      {
        nome: "Atendente 4",
        area: "DG",
        horario: "08:00-17:00",
        pausa1: "10:30-10:40",
        pausa2: "15:20-15:30",
        atividades: [
"fora de escala", "fora de escala", "telefone", "telefone", "intervalo",
"e-mail", "intervalo", "blip chat", "e-mail", "blip chat",
"e-mail", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 5",
        area: "NIM",
        horario: "08:00-17:00",
        pausa1: "10:10-10:20",
        pausa2: "15:30-15:40",
        atividades: [
"fora de escala", "fora de escala", "telefone", "telefone", "intervalo",
"e-mail", "intervalo", "blip chat", "e-mail", "blip chat",
"e-mail", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 6",
        area: "Atendimento",
        horario: "10:00-19:00",
        pausa1: "10:40-10:50",
        pausa2: "14:00-14:10",
        atividades: [
"fora de escala", "fora de escala", "fora de escala", "fora de escala", "e-mail",
"e-mail", "blip chat", "telefone", "intervalo", "blip chat",
"e-mail", "telefone", "e-mail", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 7",
        area: "Marketing",
        horario: "06:00-15:00",
        pausa1: "10:10-10:20",
        pausa2: "15:40-15:50",
        atividades: [
"blip chat", "blip chat", "telefone", "telefone", "intervalo",
"e-mail", "e-mail", "blip chat", "e-mail", "fora de escala",
"fora de escala", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 8",
        area: "Back Office",
        horario: "07:00-16:00",
        pausa1: "10:20-10:30",
        pausa2: "14:40-14:50",
        atividades: [
"fora de escala", "blip chat", "telefone", "telefone", "e-mail",
"intervalo", "e-mail", "blip chat", "e-mail", "telefone",
"fora de escala", "fora de escala", "fora de escala", "fora de escala", "fora de escala",
],
      },
      {
        nome: "Atendente 9",
        area: "DG",
        horario: "09:00-18:00",
        pausa1: "10:00-10:10",
        pausa2: "15:00-15:10",
        atividades: [
"fora de escala", "fora de escala", "fora de escala", "telefone", "BKO",
"e-mail", "intervalo", "blip chat", "e-mail", "blip chat",
"e-mail", "telefone", "fora de escala", "fora de escala", "fora de escala",
]
      },
      {
        nome: "Atendente 10",
        area: "NIM",
        horario: "10:00-19:00",
        pausa1: "10:10-10:20",
        pausa2: "15:20-15:30",
        atividades: [
"fora de escala", "fora de escala", "fora de escala", "fora de escala", "e-mail",
"e-mail", "blip chat", "telefone", "intervalo", "blip chat",
"e-mail", "telefone", "e-mail", "fora de escala", "fora de escala",
],
      }
    ];

    const areas = ["Marketing", "Back Office", "DG", "NIM", "Atendimento"];
    const horarios = ["06:00-15:00", "07:00-16:00", "08:00-17:00", "09:00-18:00", "10:00-19:00", "11:00-20:00", "12:00-21:00"];
    const pausas1 = ["10:00-10:10", "10:10-10:20", "10:20-10:30", "10:30-10:40", "10:40-10:50"];
    const pausas2 = ["14:00-14:10", "14:10-14:20", "14:20-14:30", "14:30-14:40", "14:40-14:50", "15:00-15:10", "15:10-15:20", "15:20-15:30", "15:30-15:40", "15:40-15:50"];
    const atividades = [
      { nome: "blip chat", classe: "activity-blip" },
      { nome: "e-mail", classe: "activity-email" },
      { nome: "telefone", classe: "activity-phone" },
      { nome: "BKO", classe: "activity-bko" },
      { nome: "folga", classe: "activity-folga" },
      { nome: "fora de escala", classe: "activity-fora" },
      { nome: "intervalo", classe: "activity-intervalo" },
    ];

    function criarOptions(lista, selecionado, isAtividade = false) {
      return lista
        .map(item => {
          let nome = isAtividade ? item.nome : item;
          let selected = nome === selecionado ? "selected" : "";
          return `<option ${selected}>${nome}</option>`;
        })
        .join("");
    }

    function atualizarCorSelect(select, isAtividade = false) {
      // Remove classes de atividade existentes
      atividades.forEach(a => select.classList.remove(a.classe));

      if (isAtividade) {
        // Adiciona a classe da atividade selecionada para colorir o select
        const val = select.value;
        const atividade = atividades.find(a => a.nome === val);
        if (atividade) {
          select.classList.add(atividade.classe);
        }
      }
    }

    function criarLinha(atendente) {
      let linha = `<tr>
        <td>${atendente.nome}</td>
        <td>
          <select class="form-select form-select-sm area-select">
            ${criarOptions(areas, atendente.area)}
          </select>
        </td>
        <td>
          <select class="form-select form-select-sm area-select">
            ${criarOptions(horarios, atendente.horario)}
          </select>
        </td>
        <td>
          <select class="form-select form-select-sm pausa1-select">
            ${criarOptions(pausas1, atendente.pausa1)}
          </select>
        </td>
        <td>
          <select class="form-select form-select-sm pausa2-select">
            ${criarOptions(pausas2, atendente.pausa2)}
          </select>
        </td>`;

      atendente.atividades.forEach(atividade => {
        linha += `<td>
          <select class="form-select form-select-sm atividade-select">
            ${criarOptions(atividades, atividade, true)}
          </select>
        </td>`;
      });

      linha += "</tr>";
      return linha;
    }

    function renderizarTabela() {
      const tbody = document.getElementById("tabelaAtendentes");
      tbody.innerHTML = atendentes.map(atendente => criarLinha(atendente)).join("");

      // Após inserir, atualiza cores dos selects atividade
      document.querySelectorAll(".atividade-select").forEach(select => {
        atualizarCorSelect(select, true);
      });
    }

    function atualizarCardsResumo() {
      const cardsContainer = document.getElementById("cardsResumo");

      const horarios = [
        "06:00-07:00", "07:00-08:00", "08:00-09:00", "09:00-10:00", "10:00-11:00",
        "11:00-12:00", "12:00-13:00", "13:00-14:00", "14:00-15:00", "15:00-16:00",
        "16:00-17:00", "17:00-18:00", "18:00-19:00", "19:00-20:00", "20:00-21:00"
      ];

      // Coletar estado atual da tabela para gerar resumo atualizado
      const tabela = document.getElementById("tabelaAtendentes");
      let resumoPorHorario = horarios.map(() => {
        let contagem = {};
        atividades.forEach(a => contagem[a.nome] = 0);
        return contagem;
      });

      // Para cada linha
      for (const linha of tabela.rows) {
        const selectsAtividades = linha.querySelectorAll(".atividade-select");
        selectsAtividades.forEach((select, i) => {
          const val = select.value;
          if (resumoPorHorario[i] && resumoPorHorario[i][val] !== undefined) {
            resumoPorHorario[i][val]++;
          }
        });
      }

      // Monta cards
      let htmlCards = "";
      horarios.forEach((hora, i) => {
        let resumo = resumoPorHorario[i];
        htmlCards += `<div class="col-md-2">
          <div class="card card-activity">
            <div class="card-body">
              <strong>${hora}</strong>`;
        atividades.forEach(a => {
          if (resumo[a.nome] > 0) {
            htmlCards += `<p class="m-0">${resumo[a.nome]} ${a.nome}</p>`;
          }
        });
        htmlCards += `</div></div></div>`;
      });

      cardsContainer.innerHTML = htmlCards;
    }

    function init() {
      renderizarTabela();
      atualizarCardsResumo();

      // Ao mudar qualquer select de atividade, atualiza a cor e os cards
      document.getElementById("tabelaAtendentes").addEventListener("change", (e) => {
        const target = e.target;
        if (target.classList.contains("atividade-select")) {
          atualizarCorSelect(target, true);
          atualizarCardsResumo();
        }
      });
    }

    window.onload = init;
  </script>
</body>

</html>